{"version":3,"sources":["../src/aplus_chapter.js"],"names":["define","jQuery","moodleEvent","window","CustomEvent","event","params","bubbles","cancelable","detail","evt","document","createEvent","initCustomEvent","prototype","Event","$","defaults","chapter_url_attr","exercise_url_attr","active_element_attr","loading_selector","quiz_success_selector","message_attr","load","submit","error","modal_selector","AplusChapter","element","options","dom_element","settings","extend","ajaxForms","url","modalElement","loader","messages","quizSuccess","aeOutputs","init","FormData","attr","readMessages","find","aplusExercise","input","exercises","length","dispatchEvent","exercisesIndex","exercisesSize","nextExercise","type","eq","aplusExerciseLoad","key","cloneLoader","clone","removeAttr","show","openModal","message","aplusModal","modalError","modalContent","content","renderMath","modalSuccess","exercise","badge","removeClass","empty","append","hasClass","css","hide","notifyFilterContentUpdated","fn","each","data","quiz_attr","ajax_attr","message_selector","content_element","content_selector","exercise_selector","summary_selector","response_selector","navigation_selector","dropdown_selector","last_submission_selector","ae_result_selector","submission_point_badges_selector","AplusExercise","chapter","quiz","ajax","active_element","chapterID","exercise_type","height","addEventListener","dataType","done","updateSummary","makeInputForm","id","title","def_val","wrap","form","first_div","label","html","form_field","val","substring","split","pop","i","opt","option","text","second_div","button","onlyThis","showLoader","hideLoader","input_form","update","loadLastSubmission","fail","filter","contents","remove","prependTo","cur_height","cont_height","scrollHeight","bindNavEvents","bindFormEvents","aplusModalLink","dropdown","forms","on","preventDefault","postMessage","submitAjax","formData","callback","retry","contentType","processData","xhr","status","setTimeout","feedback","updateOutput","collectFormData","output","tmpInputs","matchInputs","inputs","expected_inputs","input_id","valid","input_val","input_elem","input_field","hasAttribute","trim","get","files","form_element","outputs","tmpCollect","output_id","out_content","pollerElem","poll_url","ready_url","updateSubmission","indexOf","grep","a","aplusExerciseDetectWaits","did_wait","suburl","dispatchEventToActiveElem","input2","new_badges","old_badges","replaceWith","is","output_container","updateInputs","submission_data","exer","input_list","grader_inputs","hasOwnProperty","inArray","input_data","trigger","inputIds","inputId","inputElem","link","data_type","m","match","console","messageType","addClass","e","target","$form","prop"],"mappings":"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","sourcesContent":["/**\n * A+ chapter learning object with embedded exercises as an AMD module for Moodle.\n * The exercises are downloaded asynchronously (AJAX) and inserted in the DOM.\n *\n * In an HTML page, run the following JS code once to activate it:\n * // Construct the page chapter element.\n * jQuery(function() { jQuery(\"#exercise-page-content\").aplusChapter(); });\n *\n * Source: A+ (a-plus/exercise/static/exercise/chapter.js)\n * License: GNU GPL v3\n *\n * @module mod_astra/aplus_chapter\n */\ndefine(['jquery', 'core/event', 'mod_adastra/aplus_poll', 'theme_boost/dropdown', 'mod_adastra/aplus_modal'], function(jQuery, moodleEvent) {\n\n    /** Add CustomEvent for IE 11\n     *  Source: A+ (a-plus/assets/js/aplus.js)\n     */\n    (function () {\n        if (typeof window.CustomEvent === \"function\") return false;\n        function CustomEvent(event, params) {\n            var bubbles = params.bubbles !== undefined ? params.bubbles : false;\n            var cancelable = params.cancelable !== undefined ? params.cancelable : false;\n            var detail = params.detail !== undefined ? params.detail : undefined;\n            var evt = document.createEvent( 'CustomEvent' );\n            evt.initCustomEvent(event, bubbles, cancelable, detail);\n            return evt;\n        }\n        CustomEvent.prototype = window.Event.prototype;\n        window.CustomEvent = CustomEvent;\n    })();\n\n    /**\n     * Chapter element containing number of exercise elements.\n     *\n     */\n    ;(function($, moodleEvent, window, document, undefined) {\n        \"use strict\";\n\n        var pluginName = \"aplusChapter\";\n        var defaults = {\n            chapter_url_attr: \"data-aplus-chapter\",\n            exercise_url_attr: \"data-aplus-exercise\",\n            active_element_attr: \"data-aplus-active-element\",\n            loading_selector: \"#loading-indicator\",\n            quiz_success_selector: \"#quiz-success\",\n            message_attr: {\n                load: \"data-msg-load\",\n                submit: \"data-msg-submit\",\n                error: \"data-msg-error\"\n            },\n            modal_selector: \"#page-modal\",\n        };\n\n        function AplusChapter(element, options) {\n            this.dom_element = element;\n            this.element = $(element);\n            this.settings = $.extend({}, defaults, options);\n            this.ajaxForms = false;\n            this.url = null;\n            this.modalElement = null;\n            this.loader = null;\n            this.messages = null;\n            this.quizSuccess = null;\n            this.aeOutputs = {}; // Add active element outputs to chapter so they can be found by id later.\n            this.init();\n        }\n\n        $.extend(AplusChapter.prototype, {\n\n            /**\n             * Constructs contained exercise elements.\n             */\n            init: function() {\n                this.ajaxForms = window.FormData ? true : false;\n                this.url = this.element.attr(this.settings.chapter_url_attr);\n                this.modalElement = $(this.settings.modal_selector);\n                this.loader = $(this.settings.loading_selector);\n                this.messages = this.readMessages();\n                this.quizSuccess = $(this.settings.quiz_success_selector);\n\n                // do not include active element inputs to exercise groups\n                this.element.find(\"[\" + this.settings.active_element_attr + \"='in']\").aplusExercise(this, {input: true});\n\n                var exercises = this.element.find(\"[\" + this.settings.exercise_url_attr + \"]\");\n                if (exercises.length > 0) {\n                    this.dom_element.dispatchEvent(\n                        new CustomEvent(\"aplus:chapter-loaded\", {bubbles: true}));\n\n                    exercises.aplusExercise(this);\n                    this.exercises = exercises;\n                    this.exercisesIndex = 0;\n                    this.exercisesSize = exercises.length;\n                    this.nextExercise();\n                } else {\n                    var type = 'text/x.aplus-exercise';\n                    this.dom_element.dispatchEvent(\n                        new CustomEvent(\"aplus:exercise-loaded\", {bubbles: true, detail: {type: type}}));\n                    //$.augmentSubmitButton($(\".exercise-column\"));\n                    // changed from A+: no group submissions and no group selection UI\n                    this.dom_element.dispatchEvent(\n                        new CustomEvent(\"aplus:exercise-ready\", {bubbles: true, detail: {type: type}}));\n                }\n            },\n\n            nextExercise: function() {\n                if (this.exercisesIndex < this.exercisesSize) {\n                    this.exercises.eq(this.exercisesIndex).aplusExerciseLoad();\n                    this.exercisesIndex++;\n                }\n                this.dom_element.dispatchEvent(\n                    new CustomEvent(\"aplus:chapter-ready\", {bubbles: true}));\n            },\n\n            readMessages: function() {\n                var messages = {};\n                for (var key in this.settings.message_attr) {\n                    messages[key] = this.loader.attr(this.settings.message_attr[key]);\n                }\n                return messages;\n            },\n\n            cloneLoader: function(msgType) {\n                return $(this.settings.loading_selector)\n                    .clone().removeAttr(\"id\").show();\n            },\n\n            openModal: function(message) {\n                this.modalElement.aplusModal(\"open\", message);\n            },\n\n            modalError: function(message) {\n                this.modalElement.aplusModal(\"error\", message);\n            },\n\n            modalContent: function(content) {\n                this.modalElement.aplusModal(\"content\", { content: content });\n                this.renderMath();\n            },\n\n            modalSuccess: function(exercise, badge) {\n                /*this.modalElement.one(\"hidden.bs.modal\", function(event) {\n                    $(document.body).animate({\n                        'scrollTop': exercise.offset().top\n                    }, 300);\n                });*/\n                var content = this.quizSuccess.clone()\n                    .attr(\"class\", exercise.attr(\"class\"))\n                    .removeClass(\"exercise\")\n                    .removeAttr(\"id\")\n                    .show();\n                content.find('.badge-placeholder').empty().append(badge);\n                if (badge.hasClass(\"badge-success\") || badge.hasClass(\"badge-warning\")) {\n                    content.find('.btn-success').css('display', 'block');\n                } else {\n                    content.find('.btn-success').hide();\n                }\n                this.modalContent(content);\n            },\n\n            renderMath: function() {\n                // changed from A+: Moodle has its own API for accessing MathJax.\n                // Trigger Moodle JS event so that MathJax renders new formulas\n                // that are inserted into the modal dialog (openModal appends the modal content\n                // at runtime).\n                // This uses the Moodle filter MathJax loader.\n                moodleEvent.notifyFilterContentUpdated(this.settings.modal_selector);\n            },\n        });\n\n        $.fn[pluginName] = function(options) {\n            return this.each(function() {\n                if (!$.data(this, \"plugin_\" + pluginName)) {\n                    $.data(this, \"plugin_\" + pluginName, new AplusChapter(this, options));\n                }\n            });\n        };\n\n    })(jQuery, moodleEvent, window, document);\n\n    /**\n     * Exercise element inside chapter.\n     *\n     */\n    ;(function($, moodleEvent, window, document, undefined) {\n        \"use strict\";\n\n        var pluginName = \"aplusExercise\";\n        var loadName = \"aplusExerciseLoad\";\n        var defaults = {\n            quiz_attr: \"data-aplus-quiz\",\n            ajax_attr: \"data-aplus-ajax\",\n            message_selector: \".progress-bar\",\n            content_element: '<div class=\"exercise-content\"></div>',\n            content_selector: '.exercise-content',\n            exercise_selector: '#exercise-all',\n            summary_selector: '.exercise-summary',\n            response_selector: '.exercise-response',\n            navigation_selector: 'ul.exercise-nav a[class!=\"dropdown-toggle\"]',\n            dropdown_selector: 'ul.exercise-nav .dropdown-toggle',\n            last_submission_selector: 'ul.exercise-nav .dropdown-menu a:first-child',\n            // For active elements:\n            active_element_attr: \"data-aplus-active-element\",\n            ae_result_selector: '.ae_result',\n            input: false, // determines whether the active element is an input element or not\n            submission_point_badges_selector: \"[data-points-badge] .badge\", // summary and latest submission points in submission_plain.mustache\n        };\n\n        function AplusExercise(element, chapter, options) {\n            this.dom_element = element;\n            this.element = $(element);\n            this.chapter = chapter;\n            this.settings = $.extend({}, defaults, options);\n            this.url = null;\n            this.quiz = false;\n            this.ajax = false;\n            this.active_element = false;\n            this.loader = null;\n            this.messages = {};\n            this.init();\n        }\n\n        $.extend(AplusExercise.prototype, {\n\n            init: function() {\n                this.chapterID = this.element.attr(\"id\");\n                this.url = this.element.attr(this.chapter.settings.exercise_url_attr);\n                //this.url = this.url + \"?__r=\" + encodeURIComponent(\n                //\twindow.location.href + \"#\" + this.element.attr(\"id\"));\n                // changed from A+: URL has no __r GET query parameter\n\n                // In quiz mode feedback replaces the exercise.\n                this.quiz = (this.element.attr(this.settings.quiz_attr) !== undefined);\n\n                // Do not mess up events in an Ajax exercise.\n                this.ajax = (this.element.attr(this.settings.ajax_attr) !== undefined);\n\n                // Check if the exercise is an active element.\n                this.active_element = (this.element.attr(this.settings.active_element_attr) !== undefined);\n\n                // set exercise mime type\n                this.exercise_type =\n                    this.quiz ? 'text/x.aplus-exercise.quiz.v1' :\n                    this.ajax ? 'text/x.aplus-exercise.iframe.v1' :\n                    this.active_element ? 'text/x.aplus-exercise.active-element.v1' :\n                    'text/x.aplus-exercise';\n\n                // Add the active element outputs to a list so that the element can be found later\n                if (this.active_element && !this.settings.input) this.chapter.aeOutputs[this.chapterID] = this;\n\n                this.loader = this.chapter.cloneLoader();\n                this.element.height(this.element.height()).empty();\n                this.element.append(this.settings.content_element);\n                this.element.append(this.loader);\n\n                // Inputs are different from actual exercises and need only be loaded.\n                if (this.settings.input) {\n                    this.load();\n                }\n\n                if (!this.active_element && this.ajax) {\n                    // Add an Ajax exercise event listener to refresh the summary.\n                    var exercise = this;\n                    window.addEventListener(\"message\", function (event) {\n                        if (event.data.type === \"a-plus-refresh-stats\") {\n                            $.ajax(exercise.url, {dataType: \"html\"})\n                                .done(function(data) {\n                                    exercise.updateSummary($(data));\n                                });\n                        }\n                    });\n                }\n            },\n\n            // Construct an active element input form\n            makeInputForm: function(id, title, type, def_val) {\n                var wrap = $(\"<div>\");\n                wrap.attr(\"id\", \"exercise-all\");\n\n                var form = $(\"<form>\");\n                form.attr(\"action\", \"\");\n                form.attr(\"method\", \"post\");\n\n                var first_div = $(\"<div>\");\n                first_div.attr(\"class\", \"form-group\");\n\n                var label = $(\"<label>\");\n                label.attr(\"class\", \"control-label\");\n                label.attr(\"for\", id + \"_input\");\n                label.html(title);\n\n                var form_field;\n                if (!type || type === \"clickable\") {\n                    form_field = $(\"<textarea>\");\n                    form_field.val(def_val);\n                } else if (type === \"file\") {\n                    form_field = $(\"<input>\");\n                    form_field.attr(\"type\", \"file\");\n                    form.attr(\"enctype\", \"multipart/form-data\");\n                } else if (type.substring(0, 8) == \"dropdown\") {\n                    form_field = $(\"<select>\");\n                    // If the type is dropdown, the format of the type attribute\n                    // should be \"dropdown:option1,option2,option2,..\"\n                    var options = type.split(\":\").pop().split(\",\");\n                    $.each(options, function(i, opt) {\n                        var option = $(\"<option>\");\n                        option.text(opt);\n                        option.val(opt);\n                        form_field.append(option);\n                    });\n                }\n\n                form_field.attr(\"class\", \"form-control\");\n                form_field.attr(\"id\", id + \"_input_id\");\n                form_field.attr(\"name\", id + \"_input\");\n\n                var second_div = $(\"<div>\");\n                first_div.attr(\"class\", \"form-group\");\n\n                var button = $(\"<input>\");\n                button.attr(\"class\", \"btn btn-primary\");\n                button.attr(\"value\", \"Submit\");\n                button.attr(\"type\", \"submit\");\n\n                $(first_div).append(label, form_field);\n                $(second_div).append(button);\n                $(form).append(first_div, second_div);\n                $(wrap).append(form);\n\n                return $(wrap);\n            },\n\n            load: function(onlyThis) {\n                this.showLoader(\"load\");\n                var exercise = this;\n\n                if (exercise.settings.input) {\n                    var title = exercise.element.data(\"title\");\n                    var type = exercise.element.data(\"type\");\n                    var def_val = exercise.element.data(\"default\");\n\n                    if (!title) title = '';\n                    if (!def_val) def_val = '';\n\n                    exercise.hideLoader();\n                    var input_form = exercise.makeInputForm(exercise.chapterID, title, type, def_val);\n                    exercise.update(input_form);\n                    exercise.loadLastSubmission(input_form);\n                    if (!onlyThis) exercise.chapter.nextExercise();\n                } else {\n                    $.ajax(this.url, {dataType: \"html\"})\n                        .fail(function() {\n                            exercise.showLoader(\"error\");\n                            if (!onlyThis) exercise.chapter.nextExercise();\n                        })\n                        .done(function(data) {\n                            exercise.hideLoader();\n                            exercise.update($(data));\n                            if (exercise.quiz || exercise.active_element) {\n                                exercise.loadLastSubmission($(data));\n                            } else {\n                                exercise.renderMath();\n                                if (!onlyThis) exercise.chapter.nextExercise();\n                            }\n                        });\n                }\n            },\n\n            update: function(input) {\n                var exercise = this;\n                input = input.filter(exercise.settings.exercise_selector).contents();\n                var content = exercise.element.find(exercise.settings.content_selector)\n                    .empty().append(input).hide();\n\n                this.dom_element.dispatchEvent(\n                    new CustomEvent(\"aplus:exercise-loaded\", {bubbles: true, detail: {type: this.exercise_type}}));\n\n                if (exercise.active_element) {\n                    var title = \"\";\n                    if (exercise.element.attr(\"data-title\"))\n                        title = \"<p><b>\" + exercise.element.attr(\"data-title\") + \"</b></p>\";\n                    exercise.element.find(exercise.settings.summary_selector).remove();\n                    $(title).prependTo(exercise.element.find(exercise.settings.response_selector));\n                }\n\n                content.show();\n\n                // Active element can have height settings in the A+ exercise div that need to be\n                // attached to correct DOM-elements before setting the exercise container div height to auto\n                var cur_height = exercise.element.css('height');\n                if (exercise.active_element) {\n                    if (exercise.settings.input) {\n                        $(\"#\" + exercise.chapterID + \" textarea\").css(\"height\", cur_height);\n                    } else {\n                        if (typeof $(\"#\" + exercise.chapterID).data(\"scale\") != \"undefined\") {\n                            var cont_height = $(exercise.settings.ae_result_selector, exercise.element)[0].scrollHeight;\n                            $(exercise.settings.ae_result_selector, exercise.element).css({ \"height\" : cont_height +\"px\"});\n                        } else {\n                            $(exercise.settings.ae_result_selector, exercise.element).css(\"height\", cur_height);\n                        }\n                    }\n                }\n\n                this.element.height(\"auto\");\n                this.bindNavEvents();\n                this.bindFormEvents(content);\n                this.dom_element.dispatchEvent(\n                    new CustomEvent(\"aplus:exercise-ready\", {bubbles: true, detail: {type: this.exercise_type}}));\n            },\n\n            bindNavEvents: function() {\n                this.element.find(this.settings.navigation_selector).aplusModalLink();\n                this.element.find(this.settings.dropdown_selector).dropdown();\n                this.element.find('.page-modal').aplusModalLink();\n            },\n\n            bindFormEvents: function(content) {\n                if (!this.ajax) {\n                    var forms = content.find(\"form\").attr(\"action\", this.url);\n                    // changed from A+: no overlay messages on top of the exercise in Astra.\n                    // In addition, no need to check that the form does not belong\n                    // to an external LTI exercise since Astra does not support LTI exercises.\n                    var exercise = this;\n                    if (this.chapter.ajaxForms) {\n                        forms.on(\"submit\", function(event) {\n                            event.preventDefault();\n                            exercise.submit(this);\n                        });\n                    }\n                }\n                //$.augmentSubmitButton(content);\n                // changed from A+: no group submissions and no group selection UI\n                window.postMessage({\n                    type: \"a-plus-bind-exercise\",\n                    id: this.chapterID\n                }, \"*\");\n            },\n\n            // Submit the formData to given url and then execute the callback.\n            submitAjax: function(url, formData, callback, retry) {\n                var exercise = this;\n                $.ajax(url, {\n                    type: \"POST\",\n                    data: formData,\n                    contentType: false,\n                    processData: false,\n                    dataType: \"html\",\n                }).fail(function(xhr, textStatus, errorThrown) {\n                    // Retry a few times if submission is not successful\n                    retry = retry || 0;\n                    if (xhr.status !== 200 && retry < 5) {\n                        setTimeout(\n                            function() {\n                                exercise.submitAjax(url, formData, callback, retry + 1);\n                            }, 100);\n                    }\n                    //$(form_element).find(\":input\").prop(\"disabled\", false);\n                    //exercise.showLoader(\"error\");\n\n                    if (!exercise.active_element) {\n                        exercise.dom_element.dispatchEvent(\n                            new CustomEvent(\"aplus:exercise-submission-failure\",\n                                {bubbles: true, detail: {type: exercise.exercise_type}}));\n                        exercise.chapter.modalError(exercise.chapter.messages.error);\n                    } else {\n                        // active elements don't use loadbar so the error message must be shown\n                        // in the element container\n                        var feedback = $(\"<div>\");\n                        feedback.attr('id', 'feedback');\n                        feedback.append(exercise.chapter.messages.error);\n                        exercise.updateOutput(feedback);\n                    }\n                }).done(function (data) {\n                    callback(data);\n                });\n            },\n\n            // Construct form data from input element values\n            collectFormData: function(output, form_element) {\n                output = $(output);\n\n                //var [exercise, inputs, expected_inputs] = this.matchInputs(output); // ECMAScript 6\n                var tmpInputs = this.matchInputs(output);\n                var exercise        = tmpInputs[0],\n                    inputs          = tmpInputs[1],\n                    expected_inputs = tmpInputs[2];\n\n                // Form data to be sent for evaluation\n                var formData = new FormData();\n                var input_id = this.chapterID;\n                var valid = true;\n\n                $.each(inputs, function(i, id) {\n                    var input_val;\n                    var input_elem = $.find(\"#\" + id);\n                    var input_field = $(\"#\" + id + \"_input_id\");\n\n                    // Input can be also an output element, in which case the content must be\n                    // retrieved differently\n                    if (input_elem[0].hasAttribute(\"data-inputs\")) {\n\n                        // If an output uses another output as an input, the output used as an input can\n                        // be in evaluation which means this output cannot be evaluated yet\n                        if ($(input_elem).data(\"evaluating\")) {\n                            valid = false;\n                            formData = false;\n                            return;\n                        }\n\n                        input_val = $(input_elem).find(\".ae_result\").text().trim();\n\n                    } else if ($(input_elem).data(\"type\") === \"file\") {\n                        input_val = input_field.get(0).files[0];\n\n                    } else if (id !== input_id) {\n                        input_val = input_field.val();\n                        // Because changing an input value without submitting said input is possible,\n                        // use the latest input value that has been submitted before, if there is one,\n                        // for other inputs than the one being submitted now.\n                        if ($(input_elem).data(\"value\")) input_val = $(input_elem).data(\"value\");\n                        // Update the input box back to the value used in evaluation\n                        input_field.val(input_val);\n                    } else {\n                        input_val = input_field.val();\n                        // Update the saved value data\n                        $(input_elem).data(\"value\", input_val);\n                    }\n                    if (!input_val) valid = false;\n                    if (formData) formData.append(expected_inputs[i], input_val);\n                });\n\n                return [exercise, valid, formData];\n            },\n\n            submit: function(form_element) {\n                var input = this;\n                var chapter = this.chapter;\n                if (this.active_element) {\n                    var input_id = this.chapterID;\n                    // For every output related to this input, try to evaluate the outputs\n                    var outputs = $.find('[data-inputs~=\"' + input_id + '\"]');\n\n                    $.each(outputs,\tfunction(i, element) {\n                        //var [exercise, valid, formData] = input.collectFormData(element, form_element); // ECMAScript 6\n                        var tmpCollect = input.collectFormData(element, form_element);\n                        var exercise = tmpCollect[0],\n                            valid    = tmpCollect[1],\n                            formData = tmpCollect[2];\n\n                        var output_id = exercise.chapterID;\n                        var output = $(\"#\" + output_id);\n                        var out_content = output.find(exercise.settings.ae_result_selector);\n                        // Indicates that one of inputs has not finished evaluation\n                        if (!valid && !formData) {\n                            return; // TODO should this do something else?\n                        }\n\n                        if (!valid) {\n                            $(\"#\" + output_id).find(exercise.settings.ae_result_selector)\n                                .html('<p style=\"color:red;\">Fill out all the inputs</p>');\n                            // Abort submission because some required active element input has no value.\n                            input.dom_element.dispatchEvent(\n                                new CustomEvent(\"aplus:submission-aborted\",\n                                    {bubbles: true, detail: {type: input.exercise_type}}));\n                            return;\n                        }\n\n                        output.data('evaluating', true);\n                        // If the element has no height defined it should keep the height it had with content\n                        if (typeof output.data(\"scale\") != \"undefined\") {\n                            out_content.css({ 'height' : (out_content.height())});\n                        }\n                        out_content.html(\"<p>Evaluating</p>\");\n\n                        var url = exercise.url;\n                        exercise.submitAjax(url, formData, function(data) {\n                            var content = $(data);\n                            if (! content.find('.alert-danger').length) {\n                                // changed from A+: must provide the poll URL and the final download URL separately.\n                                var pollerElem = content.find(\".exercise-wait\");\n                                var poll_url = pollerElem.attr(\"data-poll-url\");\n                                var ready_url = pollerElem.attr(\"data-ready-url\");\n                                output.attr('data-poll-url', poll_url);\n                                output.attr('data-ready-url', ready_url);\n\n                                exercise.updateSubmission(content);\n                            } else if (content.find('.alert-danger').contents().text()\n                                    .indexOf(\"The grading queue is not configured.\") >= 0) {\n                                output.find(exercise.settings.ae_result_selector)\n                                    .html(content.find(\".alert\").text());\n                                output.find(exercise.settings.ae_result_selector).append(content.find(\".grading-task\").text());\n                            } else {\n                                output.find(exercise.settings.ae_result_selector)\n                                    .html(content.find('.alert-danger').contents());\n                            }\n                        });\n                    });\n                } else {\n                    chapter.openModal(chapter.messages.submit);\n                    var exercise = this;\n                    var url = $(form_element).attr(\"action\");\n                    var formData = new FormData(form_element);\n\n                    exercise.submitAjax(url, formData, function(data) {\n                        //$(form_element).find(\":input\").prop(\"disabled\", false);\n                        //exercise.hideLoader();\n                        var input = $(data);\n                        if (exercise.quiz) {\n                            var badge = input.find('.badge').eq(2).clone();\n                            exercise.update(input);\n                            chapter.modalSuccess(exercise.element, badge);\n                            exercise.renderMath();\n                            exercise.dom_element.dispatchEvent(\n                                new CustomEvent(\"aplus:submission-finished\",\n                                    {bubbles: true, detail: {type: exercise.exercise_type}}));\n                        } else {\n                            exercise.updateSubmission(input);\n                        }\n                    });\n                }\n            },\n\n            // Find for an active element the names of the input fields required and\n            // the corresponding names that are used in mooc-grader exercise type config\n            matchInputs: function(element) {\n                var output_id = element.attr(\"id\");\n                var exercise = this.chapter.aeOutputs[output_id];\n                // Find the ids of input elements required for this output\n                var inputs = element.attr(\"data-inputs\").split(\" \");\n                // Find the form field names the grader is expecting\n                var expected_inputs = element.find(exercise.settings.ae_result_selector).attr(\"data-expected-inputs\");\n                // make sure there are expected inputs\n                if (expected_inputs) {\n                    expected_inputs = expected_inputs.trim().split(\" \");\n                    // There might be extra whitespace or line breaks in the expected inputs data-attribute\n                    // because of how the template is generated\n                    expected_inputs = $.grep(expected_inputs, function( a ) {\n                        return a !== \"\" || a !== \"\\n\";\n                    });\n                } else {\n                    expected_inputs = [];\n                }\n                return [exercise, inputs, expected_inputs];\n            },\n\n            updateSummary: function(input) {\n                this.element.find(this.settings.summary_selector)\n                    .empty().append(\n                        input.find(this.settings.summary_selector).remove().contents()\n                    );\n                this.bindNavEvents();\n            },\n\n            updateSubmission: function(input) {\n                if (!this.active_element) {\n                    this.updateSummary(input);\n                    this.chapter.modalContent(\n                        input.filter(this.settings.exercise_selector).contents()\n                    );\n                }\n\n                // Update asynchronous feedback.\n                if (typeof($.aplusExerciseDetectWaits) == \"function\") {\n                    var exercise = this;\n                    var id;\n                    if (this.active_element) id = \"#\" + this.chapterID;\n\n                    var did_wait = $.aplusExerciseDetectWaits(function(suburl, error) {\n                        if (error) {\n                            // Polling for the final feedback failed, possibly because\n                            // the grading takes a lot of time.\n                            if (exercise.active_element) {\n                                exercise.dispatchEventToActiveElem(\"aplus:exercise-submission-failure\");\n                            } else {\n                                exercise.dom_element.dispatchEvent(\n                                    new CustomEvent(\"aplus:exercise-submission-failure\",\n                                        {bubbles: true, detail: {type: exercise.exercise_type}}));\n                                // Reload the exercise (description) in case it changes after submitting.\n                                // This also resets the disabled submit button.\n                                exercise.load(true);\n                            }\n                            return;\n                        }\n                        $.ajax(suburl).done(function(data) {\n                            if (exercise.active_element) {\n                                exercise.updateOutput(data);\n                                exercise.dispatchEventToActiveElem(\"aplus:submission-finished\");\n                                exercise.submit(); // Active element outputs can be chained\n                            } else {\n                                var input2 = $(data);\n                                var new_badges = input2.find(exercise.settings.submission_point_badges_selector);\n                                var old_badges = exercise.element.find(exercise.settings.summary_selector + \" .badge\");\n                                old_badges.eq(0).replaceWith(new_badges.eq(0).clone()); // summary points badge (best submission)\n                                old_badges.eq(2).replaceWith(new_badges.eq(1).clone()); // points badge of this submission\n                                var content = input2.filter(exercise.settings.exercise_selector).contents();\n                                if (content.text().trim() == \"\") {\n                                    exercise.chapter.modalSuccess(exercise.element, new_badges.eq(1).clone());\n                                } else {\n                                    exercise.chapter.modalContent(content);\n                                }\n                                exercise.dom_element.dispatchEvent(\n                                    new CustomEvent(\"aplus:submission-finished\",\n                                        {bubbles: true, detail: {type: exercise.exercise_type}}));\n                                // Reload the exercise (description) in case it changes after submitting.\n                                // This also resets the disabled submit button.\n                                exercise.load(true);\n                            }\n                        }).fail(function() {\n                            exercise.dom_element.dispatchEvent(\n                                new CustomEvent(\"aplus:exercise-submission-failure\",\n                                    {bubbles: true, detail: {type: exercise.exercise_type}}));\n                            exercise.chapter.modalError(exercise.chapter.messages.error);\n                            exercise.load(true);\n                        });\n                    }, id);\n                    if (!did_wait) {\n                        // No asynchronous waiting and polling were needed to retrieve\n                        // the feedback for the submission.\n                        // Reload the exercise (description) in case it changes after submitting.\n                        // This also resets the disabled submit button.\n                        exercise.load(true);\n                    }\n                }\n            },\n\n            updateOutput: function(data) {\n                // Put data in this output box\n                var exercise = this;\n                var type = exercise.element.attr(\"data-type\") || \"text\"; // default output type is text\n                var content = $(data);\n\n                // The data organisation is different depending on whether it is a new submission or\n                // the latest submission that is loaded back\n                if (!content.is(\"#feedback\")) {\n                    content = content.find(\"#feedback\");\n                }\n\n                if (type == \"text\") {\n                    content = content.text();\n                } else if (type == \"image\") {\n                    content = '<img src=\"data:image/png;base64, ' + content.text() + '\" />';\n                }\n\n                var output_container = exercise.element.find(exercise.settings.ae_result_selector);\n                output_container.html(content);\n                exercise.element.data('evaluating', false);\n                // Some result divs should scale to match the content\n                if (typeof exercise.element.data(\"scale\") != \"undefined\" ) {\n                    output_container.css({ \"height\" : \"auto\"});\n                }\n            },\n\n            // Retrieve and update latest values of the input elements related to this element\n            updateInputs: function(data) {\n                data = data.submission_data;\n                var exercise = this;\n                //var [exer, input_list, grader_inputs] = exercise.matchInputs(exercise.element); // ECMAScript 6\n                var tmpInputs = exercise.matchInputs(exercise.element);\n                var exer          = tmpInputs[0],\n                    input_list    = tmpInputs[1],\n                    grader_inputs = tmpInputs[2];\n\n                // Submission data can contain many inputs\n                // Changed from A+: submission_data returned from the server has a different format\n                // A+ uses arrays like [[\"name\", \"value\"], []...] while Astra uses an object: {name: value}\n                for (var input in data) {\n                    if (!data.hasOwnProperty(input)) {\n                        continue;\n                    }\n                    var grader_id = input;\n                    var input_id = input_list[$.inArray(grader_id, grader_inputs)];\n                    var input_data = data[input];\n                    if ($(\"#\" + input_id).data(\"type\") !== \"file\") {\n                        // Store the value of the input to be used later for submitting active\n                        // element evaluation requests\n                        $($.find(\"#\" + input_id)).data(\"value\", input_data);\n                        $(\"#\" +input_id + \"_input_id\").val(input_data).trigger('change');\n                    }\n                }\n            },\n\n            dispatchEventToActiveElem: function(event) {\n                // Send the event to this active element (output) and all related inputs.\n                this.dom_element.dispatchEvent(\n                    new CustomEvent(event, {bubbles: true, detail: {type: this.exercise_type}}));\n                // Send the event to the inputs related to this output.\n                //const [, inputIds, ] = this.matchInputs(this.element); // ECMAScript 6\n                var tmpInputs = this.matchInputs(this.element);\n                var inputIds = tmpInputs[1];\n\n                //for (const inputId of inputIds) { // ECMAScript 6, loop over the values of an array\n                for (var i = 0; i < inputIds.length; ++i) {\n                    var inputId = inputIds[i];\n                    var inputElem = $('#' + inputId).data('plugin_' + pluginName);\n                    if (inputElem) {\n                        inputElem.dom_element.dispatchEvent(\n                            new CustomEvent(event,\n                                {bubbles: true, detail: {type: inputElem.exercise_type}}));\n                    }\n                }\n            },\n\n            loadLastSubmission: function(input) {\n                var link = input.find(this.settings.last_submission_selector);\n                var exercise = this;\n                if (link.length > 0) {\n                    var url = link.attr(\"href\");\n\n                    if (url && url !== \"#\") {\n                        var data_type = \"html\";\n                        if (exercise.active_element) {\n                            // Active element input values are retrieved from the API, so\n                            // we must extract the submission number from the submission url\n                            // TODO these URLs are hardcoded here, but the server could save\n                            // them to HTML data attributes in order to avoid hardcoding\n                            var m = url.match(/submission\\.php\\?id=(\\d+)$/);\n                            if (m) {\n                                url = 'submission_data.php?id=' + m[1];\n                                data_type = \"json\";\n                            } else {\n                                console.error('Can not read the submission data URL');\n                            }\n                        }\n\n                        this.showLoader(\"load\");\n                        $.ajax(url, {dataType: data_type})\n                            .fail(function() {\n                                exercise.showLoader(\"error\");\n                            })\n                            .done(function(data) {\n                                exercise.hideLoader();\n\n                                if (!exercise.active_element) {\n                                    var f = exercise.element.find(exercise.settings.response_selector)\n                                        .empty().append(\n                                            $(data).filter(exercise.settings.exercise_selector).contents()\n                                        );\n                                    exercise.dom_element.dispatchEvent(\n                                        new CustomEvent(\"aplus:exercise-loaded\",\n                                            {bubbles: true, detail: {type: exercise.exercise_type}}));\n                                    //f.removeClass('group-augmented'); // changed from A+: no group submissions in Astra\n                                    exercise.bindFormEvents(exercise.element);\n                                    exercise.dom_element.dispatchEvent(\n                                        new CustomEvent(\"aplus:exercise-ready\",\n                                            {bubbles: true, detail: {type: exercise.exercise_type}}));\n                                } else {\n                                    // Update the output box values\n                                    exercise.updateOutput(data.feedback);\n\n                                    // Update the input values\n                                    exercise.updateInputs(data);\n                                }\n\n                                exercise.renderMath();\n                            });\n                    } else {\n                        // the math must be rendered here even if there is no submission to load\n                        exercise.renderMath();\n                    }\n                }\n                exercise.chapter.nextExercise();\n            },\n\n            showLoader: function(messageType) {\n                this.loader.show().find(this.settings.message_selector)\n                    .text(this.chapter.messages[messageType]);\n                if (messageType == \"error\") {\n                    this.loader.removeClass(\"progress-bar-animated\").addClass(\"bg-danger\");\n                } else {\n                    this.loader.addClass(\"progress-bar-animated\").removeClass(\"bg-danger\");\n                }\n            },\n\n            hideLoader: function() {\n                this.loader.hide();\n            },\n\n            renderMath: function() {\n                // changed from A+: Moodle has its own API for accessing MathJax.\n                // Trigger Moodle JS event so that MathJax renders new formulas\n                // that were modified/inserted (usually) by AJAX after the initial page load.\n                // This uses the Moodle filter MathJax loader.\n                // The selector id is like \"chapter-exercise-1\", the element that contains\n                // the embedded exercise in the chapter page.\n                moodleEvent.notifyFilterContentUpdated('#' + this.element.attr('id'));\n            },\n        });\n\n        $.fn[pluginName] = function(chapter, options) {\n            return this.each(function() {\n                if (!$.data(this, \"plugin_\" + pluginName)) {\n                    $.data(this, \"plugin_\" + pluginName, new AplusExercise(this, chapter, options));\n                }\n            });\n        };\n\n        $.fn[loadName] = function() {\n            return this.each(function() {\n                var exercise = $.data(this, \"plugin_\" + pluginName);\n                if (exercise) {\n                    exercise.load();\n                }\n            });\n        };\n\n    })(jQuery, moodleEvent, window, document);\n\n    /**\n     * Prevent double submit of exercise forms\n     */\n    (function ($) {\n        $(document).on('aplus:exercise-loaded', function(e) {\n            $(e.target).find('form').each(function () {\n                var $form = $(this);\n                if ($form.prop('method') == 'post') {\n                    $form.on('submit', function (e) {\n                        $(this).find('[type=\"submit\"]')\n                            .prop('disabled', true)\n                            .attr('data-aplus-submit-disabled', 'yes');\n                    });\n                }\n            });\n        });\n        $(document).on('aplus:exercise-submission-failure'\n                + ' aplus:submission-finished aplus:submission-aborted', function(e) {\n            $(e.target).find('[data-aplus-submit-disabled]')\n                .prop('disabled', false)\n                .removeAttr('data-aplus-submit-disabled');\n        });\n        $(document).on('hidden.bs.modal', function(e) {\n            // If the user closes the feedback modal while it is polling for\n            // the grading of the submission, the submit button remains disabled.\n            // The modal hidden event does not specify which exercise is open in\n            // the modal, so we can only enable all disabled buttons in the page.\n            $('[data-aplus-submit-disabled]')\n                .prop('disabled', false)\n                .removeAttr('data-aplus-submit-disabled');\n        });\n    })(jQuery);\n\n    return {}; // for AMD, no names are exported to the outside\n    }); // end define\n"],"file":"aplus_chapter.min.js"}
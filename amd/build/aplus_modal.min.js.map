{"version":3,"sources":["../src/aplus_modal.js"],"names":["define","jQuery","moodleEvent","$","defaults","loader_selector","loader_text_selector","title_selector","content_selector","error_message_attribute","AplusModal","element","options","settings","extend","init","prototype","loader","find","loaderText","title","content","messages","loading","text","error","attr","run","command","data","open","showError","showContent","hide","removeClass","addClass","show","on","dropdown","modal","empty","append","html","fn","each","window","document","modal_selector","file_modal_selector","body_regexp","file","AplusModalLink","link","event","preventDefault","url","aplusModal","get","highlightCode","match","length","c","aplusModalLink","notifyFilterContentUpdated","fail"],"mappings":"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","sourcesContent":["/**\n * A+ modal dialog classes.\n *\n * Source: A+ (a-plus/assets/js/aplus.js)\n * License: GNU GPL v3\n *\n * @module mod_adastra/aplus_modal\n */\ndefine(['jquery', 'core/event', 'mod_adastra/aplus_highlightcode', 'theme_boost/dropdown', 'theme_boost/modal'], function(jQuery, moodleEvent) {\n\n    /**\n     * Handle common modal dialog.\n     */\n    (function($, window, document, undefined) {\n      //\"use strict\";\n\n      var pluginName = \"aplusModal\";\n      var defaults = {\n        loader_selector: \".modal-progress\",\n        loader_text_selector: \".progress-bar\",\n        title_selector: \".modal-title\",\n        content_selector: \".modal-body\",\n        error_message_attribute: \"data-msg-error\",\n      };\n\n      function AplusModal(element, options) {\n        this.element = $(element);\n        this.settings = $.extend({}, defaults, options);\n        this.init();\n      }\n\n      $.extend(AplusModal.prototype, {\n\n        init: function() {\n          this.loader = this.element.find(this.settings.loader_selector);\n          this.loaderText = this.loader.find(this.settings.loader_text_selector);\n          this.title = this.element.find(this.settings.title_selector);\n          this.content = this.element.find(this.settings.content_selector);\n          this.messages = {\n            loading: this.loaderText.text(),\n            error: this.loaderText.attr(this.settings.error_message_attribute)\n          };\n        },\n\n        run: function(command, data) {\n          switch(command) {\n            case \"open\":\n              this.open(data);\n              break;\n            case \"error\":\n              this.showError(data);\n              break;\n            case \"content\":\n              this.showContent(data);\n              break;\n          }\n        },\n\n        open: function(data) {\n          this.title.hide();\n          this.content.hide();\n          this.loaderText\n            .removeClass('bg-danger').addClass('progress-bar-animated')\n            .text(data || this.messages.loading);\n          this.loader.show();\n          this.element.on(\"hidden.bs.modal\", function(event) {\n            $(\".dropdown-toggle\").dropdown();\n          });\n          this.element.modal(\"show\");\n        },\n\n        showError: function(data) {\n          this.loaderText\n            .removeClass('progress-bar-animated').addClass('bg-danger')\n            .text(data || this.messages.error);\n        },\n\n        showContent: function(data) {\n          this.loader.hide();\n          if (data.title) {\n            this.title.text(data.title);\n            this.title.show();\n          }\n          if (data.content instanceof jQuery) {\n            this.content.empty().append(data.content);\n          } else {\n            this.content.html(data.content);\n          }\n          this.content.show();\n          return this.content;\n        }\n      });\n\n      $.fn[pluginName] = function(command, data, options) {\n        return this.each(function() {\n          var modal = $.data(this, \"plugin_\" + pluginName);\n          if (!modal) {\n            modal = new AplusModal(this, options);\n            $.data(this, \"plugin_\" + pluginName, modal);\n          }\n          return modal.run(command, data);\n        });\n      };\n    })(jQuery, window, document);\n\n    /**\n     * Open links in a modal.\n     */\n    (function($, moodleEvent, window, document, undefined) {\n        //\"use strict\";\n\n        var pluginName = \"aplusModalLink\";\n        var defaults = {\n            modal_selector: \"#page-modal\",\n            file_modal_selector: \"#file-modal\",\n            body_regexp: /<body[^>]*>([\\s\\S]*)<\\/body>/i,\n            file: false\n        };\n\n      function AplusModalLink(element, options) {\n        this.element = $(element);\n        this.settings = $.extend({}, defaults, options);\n        this.init();\n      }\n\n      $.extend(AplusModalLink.prototype, {\n        init: function() {\n          var link = this.element;\n          var settings = this.settings;\n          link.on(\"click\", function(event) {\n            event.preventDefault();\n            var url = link.attr(\"href\");\n            if (url === \"\" || url == \"#\") {\n              return false;\n            }\n            var modal = $(settings.file ? settings.file_modal_selector : settings.modal_selector);\n            modal.aplusModal(\"open\");\n            $.get(url, function(data) {\n              if (settings.file) {\n                var text = $(\"<pre/>\").text(data);\n                modal.aplusModal(\"content\", {\n                  title: link.text(),\n                  content: text,\n                });\n                text.highlightCode();\n              } else {\n                var match = data.match(settings.body_regexp);\n                if (match !== null && match.length == 2) {\n                  data = match[1];\n                }\n                var c = modal.aplusModal(\"content\", { content: data });\n                c.find('.file-modal').aplusModalLink({file:true});\n                c.find('pre.hljs').highlightCode();\n                // changed from A+: render MathJax formulas in the modal content retrieved from the URL\n                moodleEvent.notifyFilterContentUpdated(settings.modal_selector);\n              }\n            }).fail(function() {\n              modal.aplusModal(\"error\");\n            });\n          });\n        }\n      });\n\n      $.fn[pluginName] = function(options) {\n        return this.each(function() {\n          if (!$.data(this, \"plugin_\" + pluginName)) {\n            $.data(this, \"plugin_\" + pluginName, new AplusModalLink(this, options));\n          }\n        });\n      };\n    })(jQuery, moodleEvent, window, document);\n\n    return {}; // for AMD, no names are exported to the outside\n    }); // end define\n"],"file":"aplus_modal.min.js"}